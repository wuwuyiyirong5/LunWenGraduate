\def\CTeXPreproc{Created by ctex v0.2.14, don't edit!}%%---------------------------------------------------------------------------------------------------%%
%%------ 第三章：基于4P1-P1元求解Navier-Stokes方程的移动网格方法 ------------------------------------%%
%%---------------------------------------------------------------------------------------------------%%


\chapter{基于~4P1-P1 元求解~Navier-Stokes 方程的移动网格方法}
\label{chapter:4P1-P1_moving}

    根据上一章, 我们知道混合元是求解不可压~Navier-Stokes 方程的一种重要
    方法。为了保证解的存在唯一性，需要使速度和压力两个解所在的空间满足
    ~LBB 条件。其中一种办法是使得速度空间相对压力空间来说，自由度足够多，
    例如~mini 元，Taylor-Hood 元等等。另外一中方法是对压力空间施加一些约束，
    比如说稳定化的~$P_1-P_1$ 元，$P_1-P_0$ 元。为了减少计算量，提高计算效率，通常会
    运用自适应网格方法。在文献~\cite{danaila2014newton},\cite{ebeida2009unsteady}
    \cite{berrone2009space} 中，运用了~h- 自适应的~P2P1 元。在实际的工程计
    算中，我们通常倾向于使用线性元，而非高次元。
    \cite{zheng2010posteriori} 提出自适应网格和稳定化~P1P1 元、P1P0 元相
    结合的策略. \cite{di2005moving} 将移动网格方法应用到不可压~Navier-Stokes
    方程的求解。我们移动网格部分的策略是基于文献~\cite{di2005moving} 中
    的工作。然而，不满足~LBB 条件的有限元对应用到自适应网格方法上有一定的技术困难。
    综合以上考虑，我们选取稳定的~$P_1isoP_2P_1$ 元，它自然满足~LBB 条件，详细见
    ~\cite{bercovier1979error}. 在~P1ISOP2P1 元，速度单元所在的网格可以有压
    单元的网格加密一次得到，如~Figure (\ref{fig::p-v}) 注意到在速度单元
    ~$\vec{u}$ 和压力单元~$p$ 上均是线性元。但是，速度单元网格上的~6 个基函数不
    在同一个速度单元上。因此在拼装散度块矩阵，即拼装压力单元和速度
    单元，这个过程并不显然。

    在本文的工作中，我们选取~$4P1-P1$ 元，它与~$P_1isoP_2P_1$ 拥有相同的
    网格结构，自然也满足~inf-sup 条件，但需要指出的是~$P_1isoP_2P_1$ 元的
    速度单元上的基函数都局部的位于相同的速度单元内。这给我们拼装散度
    块矩阵提供了便利：只要我们建立四个速度单元和大的压力单元之间的索引。
    索引的建立又依赖于两层网格的数据结构，这种两层网格用我们上一章提到
    的几何遗传树结构，可以建立两层网格间的对应关系。

    基于这种网格遗传树的结构，我们可以很容易的建立四个小的速度单元与
    压力宏单元间的索引。同时在~\cite{li2005multi} 中~h- 自适应方法也是基
    于这种树结构。自然的，我们可以将~h- 自适应方法应用到~4P1-P1 元上。自
    适应网格可以减少计算量，同时可以研究流体局部小尺度上的现象，比如
    涡。同时，移动网格网格方法也可以应用在~4P1-P1 元上，网格移动我们只
    移动压力网格，当压力网格移动完，速度网格由压力网格加密一次即可得
    到。但是需要注意的是，求解不可压的~Navier-Stokes 方程，在将旧网格的
    解插值到移动后的网格的过程，要满足散度为~0 的条件，这个工作由
    ~\cite{di2005moving} 中给出。

    在第一节中，我们介绍~Navier-Stokes 方程的知识。
    在第二节中我们展示~4P1-P1 的数据结构，以及单元间索引的建立过程，接下来
    我们用~4P1-P1 元近似~Navier-Stokes 方程。移动网格的策略将在第四节中给出。
    最后，我们给出数值例子。

\section{数据结构}
   4P1-P1 是基于两套不同的网格和两种有限元空间。速度网格可以由压力网格
   全局加密一次得到。网格的数据结构是基于~\cite{li2005multi} 中的几何遗
   传树结构，如~Figure(\ref{fig::hgrometrytree}) 所示。一个宏压力单元对
   应这四个速度单元，通过遍历一次所有的速度单元，利用几何遗传树结构，
   就可以建立速度单元和压力单元的~$1-1$ 对应。

   在~AFEPack 中，速度网格和压力网格分别存储在两张非正则网格~irregularMeshV
   和~irregularMeshP 上，这两张非正则网格都是建立在同一颗树上。非正则网格上，
   可以进行全局加密，局部加密以及疏化的操作，能进行这种操作得益于它的四叉树结构。
   所有的网格节点从根节点到叶子节点，都存储在非正则网格中。这里~irregularMeshV
   是由~irregularMeshP 进行全局一次加密得到的，根据非正则网格的树结构，我们可以
   通过遍历~irregularMeshV 的全部活动单元~(即叶子节点)，通过活动单元来找到它的
   父亲单元~(即叶子节点的父亲节点)。这样我们建立了从速度网格单元到压力网格单元
   之间的单向索引。还是根据活动单元的父亲节点也是具有树结构的，因此，我们可以
   根据父子节点单元~(压力单元) 来找到它对应的四个儿子单元~(即四个速度单元)，这样
   我们也建立了从压力单元到速度单元的单向索引。到这里，速度和压力间的单元已经建立了
   ~$1-1$ 索引，注意到，只要不产生新的网格单元，我们建立的索引不需要重新改。应用到
   移动网格上，我们只需要一次构建索引就可以，不管网格如何移动，网格间的索引不会改变。
   建立索引的过程参见算法~(\ref{alg::index})。


   \begin{algorithm}
     \caption{构建速度单元和压力单元间的索引}
     \begin{algorithmic}[n]
%     \begin{list}[1]
       \State \text{achieveiterator} $\gets$ \text{irregualerMeshV.beginActiveElement()}
       \State \text{enditerator} $\gets$ \text{irregualerMeshV.endActiveElement()}

       \While {\text{achieveiterator} $\neq$ \text{enditerator}}
           \State \text{int index-v-element} $\gets$
                   \text{achieveiterator}$-\rangle$ \text{index}
           \State \text{HElement} $\langle$ \text{DIM,
                   DIM}$\rangle \ast$ \text{parent} $\gets$
                   \text{activeiterator}$-\rangle$ \text{parent}
           \State \text{int index-p-element} $\gets$
                   \text {parent}$-\rangle$ \text{index}
           \State \text{int n-child} $\gets$
                   \text{parent}$-\rangle$ \text{n-child}
           \State
                  \text{index-p2v[index-p-element].resize}(\text{n-child})
           \While {$i \geq 0$ \textbf{and} $i < \text{n-child}$}
                  \State \text{HElement}$\langle$\text{DIM,DIM}$\rangle$ $\ast$\text{chi}
                         $\gets$ \text{parent}$-\rangle$\text{child[i]}
                  \State \text{int index-v-element} $\gets$
                         \text{child}$-\rangle$\text{index}
                  \State \text{index-p2v[index-p-element][i]} $\gets$
                         \text{index-v-element}
                  \State \text{index-v2p[index-v-element]} $\gets$ \text{index-p-element}
           \EndWhile
       \EndWhile
     \end{algorithmic}
%     \end{list}
     \label{alg::index}
   \end{algorithm}


\section{混合元近似}
    \subsection{流体方程}
        在~Stokes 方程
        \begin{equation}
            \begin{aligned}
                -\bigtriangleup \vec{u} + \nabla p = f \quad \text{在}\Omega \text{内}, \\
                \nabla \cdot \vec{u} = 0 \quad \text{在}\Omega \text{内},\\
                \vec{u} = 0 \qquad \text{在}\partial \Omega \text{上},
            \end{aligned}
            \label{eq::stokes}
        \end{equation}
        的基础上加一个对流项，再加上时间项，我们可以得到一个时间发展的~Navier-Stokes 方程
        \begin{equation}
            \begin{aligned}
                \frac{\partial \vec{u}}{\partial t}-\nu \nabla^2\vec{u} + \vec{u}\cdot \nabla \vec{u} + \nabla p &=& \vec{f}, \\
                \nabla \cdot \vec{u} = 0.
            \end{aligned}
            \label{eq::NS_system}
        \end{equation}
        其中~$\nu > 0$ 是一个常数，称作动力学粘性系数。跟~Stokes 方程中类似，$\vec{u}$ 表示流体速度，
        $p$ 表示压力。对流项~$\vec{u} \cdot \nabla \vec{u} := (\vec{u} \cdot \nabla) \vec{u}$，是非
        线性项，这也使得~Navier-Stokes 方程的解不唯一，这也给我们的数值计算带来了一定的挑战。
        系统~(\ref{eq::NS_system}) 的计算区域是~$\Omega$，可以是二维的或三维的。在边界~$\partial \Omega =
        \partial \Omega_D \cup \Omega_N$ 上的边界条件如下：
        \begin{equation}
            \begin{array}{ll}
                \vec{u} = \vec{w},& \mbox{ on } \partial \Omega_D,\\
                \nu \displaystyle \frac{\partial \vec{u}}{\partial n} - p =
                \vec{0}, & \mbox{ on } \partial \Omega_N.  \\
             \end{array}
            \label{eq::bc}
        \end{equation}
        其中边界~$\partial \Omega = \partial \Omega_D \bigcup \partial \Omega_N$,
        $\vec{n}$ 表示边界的外法向。
        Dirichlet 边界根据边界上的速度和外法向的乘积，可以细分为：
        \begin{equation}
            \begin{aligned}
                \partial \Omega_{+} = {x \mbox{在} \partial \Omega \mbox{上}|\vec{\omega} \cdot \vec{n} > 0}, \quad \mbox{出流边界}，\\
                \partial \Omega_{0} = {x \mbox{在} \partial \Omega \mbox{上}|\vec{\omega} \cdot \vec{n} = 0}, \quad \mbox{特征边界}，\\
                \partial \Omega_{-} = {x \mbox{在} \partial \Omega \mbox{上}|\vec{\omega} \cdot \vec{n} < 0}, \quad \mbox{入流边界}，\\
            \end{aligned}
        \end{equation}
        如果边界全部是~Direchlet 边界条件，即~$\partial \Omega = \partial \Omega_D$，那么~Navier-Stokes 问题
        ~(\ref{eq::NS_system}) 和~(\ref{eq::bc}) 的压力解除去一个常数外是唯一的。
        我们对~(\ref{eq::NS_system}) 中的不可压约束应用散度定理，
        \begin{equation}
            0 = \int_{\Omega} \nabla \cdot \vec{u} = \int_{\partial \Omega} \vec{u} \cdot \vec{n} = \int_{\Omega} \vec{\omega} \cdot \vec{n}.
        \end{equation}
        即边界值要满足相容性条件
        \begin{equation}
            \int_{\partial \Omega_{+}} \vec{\omega} \cdot \vec{n} + \int_{\partial \Omega_{-}} \vec{\omega} \cdot \vec{n} = 0.
        \end{equation}
        简单的讲，就是说流入~$\Omega$ 的流体的体积，要与流出的体积相等。这也是压力不唯一的原因。在处理入流/出流的问题时，要注意保
        证这个相容性条件，否则~Navier-Stokes 问题的解有可能不存在。一般情况下，我们在出流边界设置自然条件，相容性条件会自然满足，因此
        这时候问题~(\ref{eq::NS_system}) 和~(\ref{eq::bc}) 的压力解是唯一的。

        (\ref{eq::NS_system}) 是~Navier-Stokes 的原始变量形式, 它的另外一组表现形式是流函数形式。如果区域~$\Omega$ 是单连通的，那么不可压缩条件
        \begin{equation}
            \frac{\partial u_x}{\partial x} = -\frac{\partial u_y}{\partial y}
        \end{equation}
        意味着存在一个流函数~$\psi(x, y)$ 使得
        \begin{equation}
            u_x = \frac{\partial \psi}{\partial y}, \quad u_y = -\frac{\partial \psi}{\partial x}.
        \end{equation}
        $\psi(x, y)$ 除去一个常数外被~$\vec{u}$ 唯一确定。
        对~(\ref{eq::NS_system}) 中的动量方程取~curl，我们可以得到流函数形式：
        \begin{equation}
            -\nu \nabla^4 \psi + \frac{\partial \psi}{\partial y}\frac{\partial}{\partial x}(\nabla^2\psi) - \frac{\partial \psi}{\partial x}\frac{\partial }{\partial y}(\nabla^2 \psi) = -curl \vec{f}
            \label{eq::stream_line}
        \end{equation}
        但由于流函数形式~(\ref{eq::stream_line}) 在三维空间没有一般形式，所以流函数形式只在二维。我们还是研究~(\ref{eq::NS_system}) 中的原始
        变量形式。
    \subsection{弱形式}
        我们定义解和检验空间如下：
        \begin{eqnarray}
            \mathbf{H}_E^1 & := & \left\{ \vec{u} \in \mathcal{H}^1(\Omega)^d \big|
            \vec{u} = \vec{w} \mbox{ on } \partial \Omega_D \right\},\\
            \mathbf{H}_{E_0}^1 & := & \left\{ \vec{v} \in \mathcal{H}^1(\Omega)^d \big|
            \vec{u} = \vec{0} \mbox{ on } \partial \Omega_D \right\}.
        \end{eqnarray}
        那么变分形式为：寻找~$(\vec{u}, p) \in (\mathbf{H}_E^1,
        L_2(\Omega))$ 使得
        \begin{eqnarray}
             \int_{\Omega}\frac{\partial \vec{u}}{\partial t} \cdot \vec{v} +
            \nu \int_\Omega \nabla \vec{u} : \nabla \vec{v} + \int_\Omega \left(
            \vec{u} \cdot \nabla \vec{u} \right) \cdot \vec{v} - \int p
            \left( \nabla \cdot \vec{v} \right) & = & \int_\Omega \vec{f} \cdot
            \vec{v}, \label{eq::generalweak_momentum}\\
             & & \forall \vec{v} \in \mathbf{H}_{E_0}^1,\notag \\
             \int_\Omega q \left( \nabla \cdot \vec{u} \right) & = & 0,
             \label{eq::generalweak_mass} \\
            & & \forall q \in L_2(\Omega). \notag
       \end{eqnarray}

       其中~$\nabla \vec{u} : \nabla \vec{v}$ 表示纯量的乘积，在二维中为
       ~$\nabla u_x \cdot \nabla v_x + \nabla u_y \cdot \nabla v_y$.
       我们在构造混合元近似的时候要确保可解性条件
       \begin{equation}
            \int_{\Omega}p \nabla \cdot \vec{v} = 0 \quad \text{对任意的}\vec{v} \in \mathbf{H}_{E_0}^1 \Rightarrow \left\{ \begin{array}{ll}
                p = \mbox{constant} & \text{如果} \partial \Omega = \partial \Omega_D \\
                p = 0 & \text{其他情况}
            \end{array}
            \right.
            \label{eq::solve_condition}
       \end{equation}
        (\ref{eq::solve_condition}) 可以由~inf-sup 条件推出。
        \begin{equation}
            \inf_{ q \neq \mbox{constant}} \sup_{\vec{v} \neq \vec{0}} \frac{|(q, \nabla \cdot \vec{v})|}{||vec{v}||_{H(\Omega)^1} ||q||_{L(\Omega)^0}} \geq \gamma > 0.
        \end{equation}

       假设~$\tau_h$ 是~$\Omega$ 上对压力网格的三角剖分，网格尺度 ~$h = max_{T
         \in \tau_h} diam(T)$, $T$ 为三角剖分 ~$\tau_h$ 的单元。对应的，
       $\tau_{\frac{h}{2}}$ 是对速度网格的三角剖分。基于
       ~$\tau_{\frac{h}{2}}$ 和 ~$\tau_{h}$ 上的有限元空间 ~$X_E^h$ 和 ~$P_h$
       满足
       \begin{equation}
         X_E^h \subset \mathcal{H}_E, \quad P_h \subset L_2(\Omega)
         \notag
       \end{equation}

       那么~(\ref{eq::generalweak_momentum}) 和 ~(\ref{eq::generalweak_mass})
       可以写成如下形式: 寻找 ~$(\vec{u}_h, p_h) \in X_E^h \times P_h$ 使得
       \begin{equation}
         \begin{aligned}
           &\int_{\Omega}\frac{\partial \vec{u}_h}{\partial t} \cdot \vec{v}_h
           + \nu \int_\Omega \nabla \vec{u}_h : \nabla \vec{v}_h  \\
           + & \int_\Omega \left( \vec{u}_h \cdot \nabla \vec{u}_h \right)
           \cdot \vec{v}_h - \int_\Omega p_h \left( \nabla \cdot \vec{v}_h
           \right) & = &\int_\Omega \vec{f} \cdot \vec{v}_h, &\quad
           \forall \vec{v}_h \in \mathbf{X}_0^h;  \\
           & \int_\Omega q_h \left( \nabla \cdot \vec{u}_h \right) & = &0,&
           \quad \forall q_h \in P^h.
           \label{eq::discreted_weak}
         \end{aligned}
       \end{equation}

   为了简便，我们时间离散上用显示~Euler 格式：
   $\forall (\vec{v}_h, q_h) \in \mathbf{X}_0^h \times P^h$
   \begin{equation}
     \begin{aligned}
       \int_{\Omega} \frac{\vec{u}_h^{(n + 1)} -
         \vec{u}_h^{(n)}}{\delta t} \cdot \vec{v} + \nu \int_{\Omega} \nabla
       \vec{u}_h^{(n + 1)} : \nabla \vec{v}_h - \int_{\Omega} p_h^{(n
         + 1)} \left( \nabla \cdot \vec{v}_h \right)
       & = \int_{\Omega}\left(\vec{f} + \vec{u}_h^{(n)} \cdot \nabla \vec{u}_h^{(n)}
       \right) \cdot \vec{v} &\\
       \int_{\Omega} q_h \nabla \cdot \vec{u}_h^{(n + 1)} & = 0.&
     \end{aligned}
     \label{eq::time_discreted_weak}
   \end{equation}
   令 ~$\{\phi_j \}_{j = 1}^n$ 和 ~$\{\psi_k\}_{k = 1}^m$ 分别为速度和压
   力的线性元基函数。则数值解~$\vec{u}_h^{(n + 1)} = (u_{xh}^{(n + 1)},
   u_{yh}^{(n + 1)}), p_h$ 可以写成如下形式：
   \begin{equation}
     u_{xh}^{(n + 1)} = \sum_{j = 1}^n u_j \phi_j, \quad u_{yh}^{(n +
       1)} = \sum_{j = 1}^n v_j \phi_j, \quad p_h^{(n + 1)} = \sum_{k
       = 1}^m p_k \psi_k \notag
   \end{equation}
   将~$u_{xh}^{(n + 1)}, u_{yh}^{(n + 1)}, p_h^{(n + 1)}$ 带入离散弱形式
   ~(\ref{eq::time_discreted_weak}) 中，可以
   得到线性方程组
   \begin{equation}
     \left[
       \begin{array}{lll}
         \frac{1}{dt} M + \nu A & 0 & B_x^T \\
         0 & \frac{1}{dt} M +\nu A  & B_y^T \\
         B_x & B_y & 0
       \end{array}
     \right]
     \left[
       \begin{array}{c}
         u_x \\
         u_y \\
         p
       \end{array}
     \right] =
     \left[
       \begin{array}{c}
         f_x \\
         f_y \\
         g
       \end{array}
     \right],
     \label{eq::linear_system}
   \end{equation}
   其中~M 是 ~$n \times n$ 的质量矩阵，A 是拉普拉斯矩阵，由以下形式：
   \begin{eqnarray}
     A & = & [a_{ij}], \quad a_{ij} = \int_\Omega \nabla \phi_i \cdot \nabla
     \phi_j  \notag \\
     M & = & [m_{ij}], \quad m_{ij} = \int_{\Omega}\phi_i \phi_j \notag \\
     B_x^T & = & [bx^T_{ik}], \quad bx^T_{ik} = \int_{\Omega} \psi_k
     \frac{\partial{\phi_i}}{\partial x}  \notag \\
     B_y^T & = & [by^T_{ik}], \quad by^T_{ik} = \int_{\Omega} \psi_k
     \frac{\partial {\phi_i}}{\partial y}  \notag \\
     f_x & = & [f_i], \quad f_i = \int_\Omega (\frac{u_{xh}^{(n)}}{dt} - (u_{xh}^{(n)}
     \frac{\partial u_{xh}^{(n)}}{\partial x} + u_{yh}^{(n)} \frac{\partial
       u_{xh}^{(n)}}{\partial y}) \phi_i \notag \\
     f_y & = & [f_i], \quad f_i = \int_\Omega (\frac{u_{yh}^{(n)}}{dt} - (u_{xh}^{(n)}
     \frac{\partial u_{yh}^{(n)}}{\partial x} + u_{yh}^{(n)} \frac{\partial
       u_{yh}^{(n)}}{\partial y}) \phi_i \notag \\
     g & = &  [g_k],\quad  g_i = 0. \notag
   \end{eqnarray}

   接下来我们着重解释一下散度块矩阵~$B_x B_y, B_x^T, B_y^T$ 的拼装。 以
   ~$B_x^T$ 为例, 令~$\triangle_{v_i}$ 为一个速度单元，我们可以通过上一节建立的
   单元索引来找到对应的压力单元 ~$\triangle_{p_k}$(如 ~Figure
   (\ref{fig::matrix_assemble})). $\phi_{i_1}, \phi_{i_2}, \phi_{i_3}$
   是定义在速度单元 ~$\triangle_{v_i}$ 上的线性元基函数，下标 ~$i_1,
   i_2, i_3$ 表示该顶点上的自由度在速度全部自由度的全局编号。同时
   ~$\psi_{k_1}, \psi_{k_2}, \psi_{k_3}$ 是定义在压力单元
   ~$\triangle_{p_k}$ 上的线性元基函数，$k_1, k_2, k_3$ 代表单元
   ~$\triangle_{p_k}$ 上的自由度在压力全部自由度中的全局编号。
   因此 单元 ~$\triangle_{p_k}$ 和 ~$\triangle_{v_i}$ 对 ~$B_x^T$ 的贡献
   为
   \begin{equation}
     \left[
     \begin{array}{lll}
       \int_{\triangle_{v_i}}\psi_{k_1} \frac{\partial
         \phi_{i_1}}{\partial x} & \int_{\triangle_{v_i}} \psi_{k_2}
       \frac{\partial \phi_{i_1}}{\partial x} & \int_{\triangle_{v_i}}
       \psi_{k_3} \frac{\partial \phi_{i_1}}{\partial x} \\
       \int_{\triangle_{v_i}} \psi_{k_1} \frac{\partial
         \phi_{i_2}}{\partial x} & \int_{\triangle_{v_i}} \psi_{k_2}
       \frac{\partial \phi_{i_2}}{\partial x} & \int_{\triangle_{v_i}}
       \psi_{k_3} \frac{\partial \phi_{i_2}}{\partial x} \\
       \int_{\triangle_{v_i}} \psi_{k_1} \frac{\partial
         \phi_{i_3}}{\partial x} & \int_{\triangle_{v_i}} \psi_{k_2}
       \frac{\partial \phi_{i_3}}{\partial x} & \int_{\triangle_{v_i}}
       \psi_{k_3} \frac{\partial \phi_{i_3}}{\partial x}
     \end{array}
   \right]
   \label{eq::element_matrix}
   \end{equation}

   将贡献矩阵 ~(\ref{eq::element_matrix}) 加到 ~$B_x^T$ 中的相应位置
   ~$(i_1,k_1)$, $(i_1, k_2)$, $(i_1, k_3)$, $(i_2, k_1)$, $(i_2, k_2)$,
   $(i_2,k_3)$, $(i_3, k_1)$, $(i_3, k_2)$, $(i_3, k_3)$ to  $B_x^T$.
   上。通过遍历所有的速度单元，重复上面的操作，$B_x^T$ 拼装完成。
   $B_y^T$ 也可以同样拼装。

   $B_x$ 和 ~$B_y$ 的拼装是遍历所有的压力单元，通过单元索引，找到对应的
   四个速度单元，然后分别用压力单元和四个速度单元进行拼装。过程相似，
   便不再赘述。
   \begin{figure}
     \centering
     \begin{tikzpicture}
       % 三角形
       \draw (2, 1) -- (4, 1) -- (3, 3) -- cycle;
       % 三个顶点
       \draw (2, 1) circle(0.05cm);
       \draw (4, 1) circle(0.05cm);
       \draw (3, 3) circle(0.05cm);
       \draw (3, 2) node{$p_k$};
       % 三个顶点标号.
       \draw (1.7, 1) node {$k_2$};
       \draw (4.3, 1) node {$k_1$};
       \draw (3, 3.3) node {$k_3$};
       % 四个三角形
       \draw (5, 1) -- (6, 3) -- (7, 1) -- cycle;
       \draw (5.5, 2) -- (6.5, 2) -- (6, 1) -- cycle;
       % 六个顶点
       \draw [fill = black](6.5, 2) circle(0.05cm);
       \draw [fill = black](5.5, 2) circle(0.05cm);
       \draw [fill = black](6, 3) circle(0.05cm);
       % 三个顶点标号.
       \draw (6.8, 2) node {$i_1$};
       \draw (6.3, 3.3) node {$i_2$};
       \draw (5.2, 2) node {$i_3$};
       % 单元标记.
       \draw (6, 2.5) node {$v_i$};
       \draw (5.5, 1.5) node {$v_j$};
       \draw (6.5, 1.5) node {$v_p$};
       \draw (6, 1.5) node {$v_q$};
     \end{tikzpicture}
     \caption{左: $p$ 单元; 右: 与压力单元对应的~4 个速度~$v$ 单元 }
     \label{fig::matrix_assemble}
   \end{figure}
   \section{预处理策略}
      在我们的求解~Navier-Stokes 方程的算法中，我们用稳态的~Stokes 方程的解作为初始值，因此在这一部分中，我们考虑针对
      ~Stokes 方程的预处理方法。我们写出~\eqref{eq::stokes} 的~$4P1-P1$ 近似的离散弱形式：寻找 ~$(\vec{u}_h, p_h) \in X_E^h \times P_h$
      使得
       \begin{equation}
         \begin{aligned}
           \nu \int_\Omega \nabla \vec{u}_h : \nabla \vec{v}_h
           - \int_\Omega p_h \left( \nabla \cdot \vec{v}_h
           \right) & = \int_\Omega \vec{f} \cdot \vec{v}_h, \quad
           \forall \vec{v}_h \in \mathbf{X}_0^h,&  \\
           \int_\Omega q_h \left( \nabla \cdot \vec{u}_h \right) & = 0,
           \quad \forall q_h \in P^h.&
           \label{eq::discreted_weak_stokes}
         \end{aligned}
       \end{equation}
      同样的，令 ~$\{\phi_j \}_{j = 1}^n$ 和 ~$\{\psi_k\}_{k = 1}^m$ 分别为 ~$X_E^h$ 和~$\times P_h$ 的基函数。则数值解
      ~$\vec{u}_h^{(n + 1)} = (u_{xh}^{(n + 1)}, u_{yh}^{(n + 1)}), p_h$ 可以写成如下形式：
      \begin{equation}
         u_{xh}^{(n + 1)} = \sum_{j = 1}^n u_j \phi_j, \quad u_{yh}^{(n +
         1)} = \sum_{j = 1}^n v_j \phi_j, \quad p_h^{(n + 1)} = \sum_{k
         = 1}^m p_k \psi_k \notag
      \end{equation}
      将~$u_{xh}^{(n + 1)}, u_{yh}^{(n + 1)}, p_h^{(n + 1)}$ 带入离散弱形式
      ~(\ref{eq::time_discreted_weak}) 中，可以
      得到线性方程组
       \begin{equation}
         \left[
           \begin{array}{lll}
             \nu A & 0 & B_x^T \\
             0 & \nu A  & B_y^T \\
             B_x & B_y & 0
           \end{array}
         \right]
         \left[
           \begin{array}{c}
              u_x \\
              u_y \\
              p
           \end{array}
         \right] =
         \left[
           \begin{array}{c}
             \hat{f}_x \\
             \hat{f}_y \\
             \hat{g}
           \end{array}
         \right],
         \label{eq::linear_system_stokes}
       \end{equation}
     为简便起见，我们令~(\ref{eq::linear_system_stokes}) 中的右端项分别取为
     ~$\hat{f}_x = 0, \hat{f}_y = 0, \hat{g} = 0$。我们选用~MINRES(极小化残差方法) 来求解~\eqref{eq::linear_system_stokes}，通常情况下，
     我们要为~MINRES 选择一个有效的预处理子。在~\cite{elman2005finite} 中，提出压力空间的质量矩阵:
     \begin{equation}
        Q  =  [Q_{ij}], \quad q_{ij} = \int_\Omega \nabla \psi_i \cdot \nabla \psi_j  \notag
     \end{equation}
     可以作为~schur 补~$S = B_x A^{-1} B_x^T + B_y A^{-1} B_y^T$ 的近似矩阵。在实际的计算中，压力质量矩阵的对角阵~$\hat{Q} = diag(Q)$，就能
     有比较好的效果。因此，我们选取对角块矩阵~$K$
       \begin{equation}
         K = \left[
               \begin{array}{lll}
                 \nu A & 0 & 0 \\
                 0 & \nu A  & 0 \\
                 0 & 0 & \hat{Q}
               \end{array}
             \right]
       \end{equation}
       作为~(\eqref{eq::linear_system_stokes}) 的系数矩阵~$M$ 的近似。
       \begin{equation}
         M = \left[
               \begin{array}{lll}
                 \nu A & 0 & B_x^T \\
                 0 & \nu A  & B_y^T \\
                 B_x & B_y & 0
               \end{array}
             \right],
       \end{equation}
   在预处理过程中，我们需要对矩阵~$K$ 求逆，即完成 ~$V_{dst} = K^{-1} V_{src}$ 的操作，
   其中~$V_{dst}, V_{src}$ 分别为
   \begin{equation}
      V_{dst} = (V_{dst}^x, V_{dst}^y, V_{dst}^p)^T,\quad V_{src} = (V_{src}^x, V_{src}^y, V_{src}^p)^T.
   \end{equation}
   我们不是直接求解 ~$V_{dst} = K^{-1} V_{src}$，而是把~$K$ 分成三个对角块 ~$(0, 0)$，$(1, 1)$ 和 ~$(2, 2)$ 块，
   然后每个块进行单独求解。我们用应用在~possion 问题的代数多重网格求解器来求解
   \begin{eqnarray}
      \nu A V_{des}^x = V_{src}^x, \notag \\
      \nu A V_{des}^y = V_{src}^y. \notag
   \end{eqnarray}
   对于 ~$(2, 2)$ 块，
   \begin{equation}
      V_{dst}^p = \frac{V_{src}^p}{diag(\hat{Q})}
   \end{equation}
   那么我们就得到了~$V_{dst}$。

\section{移动网格策略}

   我们主要的想法是有两套网格，速度网格和压力网格，速度网格可以由压力
   网格加密一次得到。因此我们对压力网格进行移动，然后对移动完的压力网
   格全局加密一次，即可实现对速度网格的同步移动。

   在 ~$t = t_{n + 1}$ 时刻， 用上一章的方法可以得到有限元解
   ~$(\vec{u}_h^{(n + 1)}, p_h^{(n + 1)})$. 下面的问题是如何用新的数值
   解和旧的网格~$\mathcal {T}_h^{(n)}$ 来获得新的网格~$\mathcal {T}_h^{(n +
   1)}$. 我们采取文献 ~\cite{di2005moving} 中的方法，注意到我们区域的边
   界均是~Dirichlet 边界，分为以下四步：
   \subsection{Step 1 获取~Monitor}
     选择一个合适的控制函数，对于移动网格的结果是非常重要的。应用在不
     可压~Navier-Stokes 方程上的控制函数主要有如下几种.
     令 ~$m = \frac{1}{G}$ 其中~$m$ 是~(\ref{eq::logical}) 中的一个纯量函数。
     关于~$G$ 有集中不同的选择. 一种是基于涡量
     \begin{equation}
       G_0 = \sqrt{1 + \alpha |\omega|^\beta}
       \label{eq::monitor_vorticity}
     \end{equation}
     其中~$\omega = \nabla \times \vec{u}$, $\alpha$ 和~$\beta$ 是两个正的
     常数。

      另外一个选择，$G$ 是基于数值解的梯度
      \begin{equation}
        G_1 = \sqrt{1 + \alpha |\nabla \vec{u}|^\beta}
        \label{eq::monitor_gradient}
      \end{equation}

      对于线性元~$v_h$ 逼近真实解~$v$，下面的后验误差估计公式可以用来近似
      计算误差
      \begin{equation}
        |v - v_h|_{1, \Omega} \sim \eta(v_h) := \sqrt{\sum\limits_{l:
            \text{内部边界}} \int_l \left[ \nabla v_h \cdot \vec{n}_l
            \right]^2 dl}
      \end{equation}
      其中~$[\cdot]_l$ 意味着边~$l$ 上的跳跃，即~$[v]_l = v|_{l^{+}} -
      v|_{l^{+}}$. 很自然的在每个单元上等分布数值误差~$\eta(v_h)$, 控制
      函数为一下形式
      \begin{equation}
        G_2 = \sqrt{1 + \alpha \eta^2(v_h)}
        \label{eq::monitor_posterror}
      \end{equation}
      \cite{di2005moving} 中对~(\ref{eq::monitor_posterror}) 进行了改进
      \begin{equation}
        G_3 = \sqrt{1 + \alpha \left[ \eta(v_h) / \text{max}\eta(v_h)
          \right]^\beta}
        \label{eq::monitor_posterror_modified}
      \end{equation}
      其中~$\beta > 2$ 时有更好的效果。

   \subsection{Step 2 获取新的逻辑网格}
     求解椭圆形方程
     \begin{eqnarray}
       \begin{aligned}
         \nabla_{\vec{x}} \left ( m \nabla_{\vec{x}} \vec{\xi} \right)
         = 0 \\
         \vec{\xi} = \vec{\xi}_b
       \end{aligned}
       \label{eq::logical}
     \end{eqnarray}
     其中 ~$m$ 是上一节中的纯量函数，通常依赖于~$(\vec{u}_h^{(n + 1)},
     p_h^{(n + 1)})$。我们定义初始的逻辑网格~$\mathcal{T}_c (\mathcal
     {A}^{0} \text{为它的节点})$。一旦初始的逻辑网格给定，在整个的求解
     过程中，将一直保持不变。通过求解~(\ref{eq::logical}) 我们可以得到
     新的逻辑网格~$\mathcal{T}_c^*$($\mathcal{A}^*$ 为它的节点)。
  \subsection{Step 3 物理网格的移动方向}

     我们先引入一些定义。$\mathcal{T}_h$ 为物理区域上的三角剖分。第~i 个
     点定义为~$X_i$，以~$X_i$ 为顶点的单元的集合称之为~$T_i$。相应的计算
     区域上的标记为 ~$\mathcal{T}_c, \mathcal{A}_i$ 和 ~$T_{i,c}$。
     $\mathcal{A}_i$ 点在计算区域上的坐标定义为 ~$(\mathcal{A}_i^1,
     \mathcal{A}_i^2)^T$。在 ~Step 1 结束后，我们得到了新的逻辑网格
     ~$\mathcal{T}_c^*$ 和它的顶点 ~$\mathcal{A}_i^*$. 从而我们得到新旧
     逻辑网格的差:
     \begin{equation}
       \delta \mathcal{A}_i  = \mathcal{A}^{(0)} - \mathcal{A}_i^*
     \end{equation}
     对于一个给定的单元~$E \in \mathcal{T}_h$, $X_{E_k}, 0 \leq k \leq
     2 $, 作为它的三个顶点。从~$V_{\mathcal{T}_c^*}(\Omega)$ 到
     ~$V_{\mathcal{T}}(\Omega)$ 的分片线性映射在单元 ~$E$ 上的梯度是常数，
     并且满足下面的方程组：
     \begin{eqnarray}
       \begin{aligned}
        & \left (
           \begin{array}{cc}
             \mathcal{A}_{E_1}^{*, 1} - \mathcal{A}_{E_0}^{*, 1} &
             \mathcal{A}_{E_2}^{*, 1} - \mathcal{A}_{E_0}^{*, 1} \\
             \mathcal{A}_{E_1}^{*, 2} - \mathcal{A}_{E_0}^{*, 2} &
             \mathcal{A}_{E_2}^{*, 2} - \mathcal{A}_{E_0}^{*, 2}
           \end{array}
         \right )
         \left (
           \begin{array}{cc}
             \frac{\partial x^1}{\partial \xi^1} & \frac{\partial
               x^1}{\partial \xi^2} \\
             \frac{\partial x^2}{\partial
               \xi^1} & \frac{\partial x^2}{\partial \xi^2}
           \end{array}
         \right ) \notag \\ = &
         \left (
           \begin{array}{ll}
             X_{E_1}^1 - X_{E_0}^1 & X_{E_2}^1 - X_{E_0}^1 \\
             X_{E_1}^2 - X_{E_0}^2 & X_{E_2}^2 - X_{E_0}^2
           \end{array}
         \right )
       \end{aligned}
     \end{eqnarray}

  求解上面的方程组，可以获得单元 ~$E$ 上的~$\partial \vec{x} / \partial
  \xi$. 如果以单元的面积作为权重，则第~i 个点的加权平均的位移定义如下:
  \begin{eqnarray}
    \delta X_i = \frac{\sum\limits_{E \in T_i} |E| \frac{\partial
        \vec{x}}{\partial \xi}|_{\text{in} E} \delta
      \mathcal{A}_i}{\sum\limits_{E \in T_i} |E|}.
  \end{eqnarray}
  其中~$|E|$ 代表单元~$E$ 的面积. 为了避免网格发生缠结，在网格移动向量前乘
  上一个常量~$\mu$, 即物理区域上新网格~$\mathcal{T}^*$ 的节点表示为：
  \begin{equation}
    X_i^* = X_i + \mu \delta X_i.
  \end{equation}
  文献~\cite{di2005moving} 中提出~$\mu$ 按以下方式给出:
  \begin{equation}
    \left |
      \begin{array}{ccc}
        1 & 1 & 1 \\
        x_0^1 + \mu \delta x_0^1 & x_1^1 + \mu \delta x_1^1 & x_2^1 +
        \mu \delta x_2^1 \\
        x_0^2 + \mu \delta x_0^2 & x_1^2 + \mu \delta x_1^2 & x_2^2 +
        \mu \delta x_2 ^2
      \end{array}
    \right | = 0
    \label{eq::muValue}
  \end{equation}
  其中~$ \vec{x}_i = (x_i^1, x_i^2), 0 \leq i \leq 2$ 表示第~i 个点的坐标。
  令~$\mu_i^*$ 为方程~(\ref{eq::muValue}) 的最小正根，则令
  \begin{equation}
    \mu = \text{min} (1, \frac{\mu_i^*}{2}).
  \end{equation}

  \subsection{Step 4 散度为~0 的插值}
    用移动网格方法求解不可压流体时，要保证插值的过程散度是为~0 的。通过
    求解一个对流方程，对流的速度是网格的移动速度，从而实现旧的物理网格
    上的数值解到新的物理网格上数值解的插值。令~$u_h = \sum u_i \phi_i,
    u_h \in \mathcal{X}_E^h$， $\phi_i$ 是有限元空间~$\mathcal{X}_h$ 的
    基函数。引入一个虚拟的时间~$\tau$, 假设基函数~$\phi_i$ 和~$u_i$ 均是关
    于~$\tau$ 的函数, 即~$\phi_i = \phi_i(\tau), u_i = u_i(\tau)$.
    我们引入一个从旧网格~$x^{\text{旧}}$ 到新网格~$x^{\text{新}}$ 网格点的
    连续变换：
    \begin{equation}
       x_i(\tau) = X_i + \tau (X_i^* - X_i), \qquad \tau \in [0, 1]
       \label{eq::mesh_old2new}
    \end{equation}
    其中~$X_i^* = x_i^{\text{新}}, X_i = x_i^{\text{旧}}$
    基于~(\ref{eq::mesh_old2new}) 的连续形式~$x(\tau) = x_{\text{旧}} +
    \tau (x^{\text{新}} - x^{\text{旧}})$，基函数可以定义为
    ~$\phi_i(\tau) = \phi_i(x(\tau))$ 并且 ~$u_i = u_i(x(\tau))$.

    在插值的过程中，我们要保持解曲线~$u_h = \sum u_i \phi_i$ 关于~$\tau$
    在弱形式下是不变的. 即对~$\forall \psi \in \mathcal{X}_h$,
    $(\partial_{\tau} u_h, \psi) = 0$。通过直接计算可得
    \begin{equation}
      \frac{\partial \phi}{\partial \tau} = -\nabla_{\vec{x}} \phi_i
      \cdot \delta \vec{x}
    \end{equation}
    其中~$\delta \vec{x} = x^{\text{旧}} - x^{\text{新}}$。紧接着
    \begin{eqnarray}
      \begin{aligned}
        0 & = (\partial_{\tau} u_h , \psi) \\
        & = (\partial_{\tau} \sum u_i(x(\tau)) \phi_i, \psi) \\
        & = (\sum \phi_i \partial u_i(x(\tau)) + \sum u_i \partial_{\tau}
        \phi_i) \\
        & =  (\sum \phi_i \partial_{\tau} u_i(x(\tau)) -\sum u_i
        \nabla_{\vec{x}}\phi_i \cdot \delta \vec{x}, \psi) \\
        & =  (\sum \phi_i \partial_{\tau} u_i(x(\tau)) - \nabla_{\vec{x}}u_h
        \cdot \delta \vec{x}, \psi)
     \end{aligned}
     \label{eq::divergence_free}
    \end{eqnarray}
    我们将~(\ref{eq::divergence_free}) 应用到不可压流上，即速度场要满足
    散度为~0 的条件。令~$\mathcal{X}_h$ 为散度为~0 的空间：
    \begin{equation}
      \mathcal{X}_E^h = X_E^h \cap \{\vec{u}_h|\nabla \cdot \vec{u}_h
      = 0 \}
    \end{equation}
    那么~(\ref{eq::divergence_free}) 将变成：寻找~$w_h \in
    \mathcal{X}_h$ 使得
    \begin{equation}
      \left( \sum \phi_i \partial_{\tau} u_i - \sum u_i \nabla_{\vec{x}}
      \phi_i \cdot \delta \vec{x}, z_h \right) = 0 \quad \forall z_h
      \in \mathcal{X}_h.
      \label{eq::div_free_space}
    \end{equation}
    上面的结果意味着
    \begin{equation}
      \sum \phi_i \partial_{\tau} u_i - \sum u_i \nabla_{\vec{x}}
      \phi_i \cdot \delta \vec{x} \in \mathcal{X}_h^{\perp}
    \end{equation}
    其中~$\mathcal{X}_h^{\perp} + \mathcal{X}_h = L^2$. 根据文献
    ~\cite{gunzburger2012finite} 中的定理~2.7, 如果区域~$\Omega$ 是单连通
    的, 那么
    \begin{equation}
      \mathcal{X}_h^{\perp} = \{ \nabla q | q \in H^1(\Omega) \}
      \label{eq::orthogonal_space}
    \end{equation}
    则存在~$\nabla p \in \mathcal{X}_h^{\perp}$ 使得
    \begin{eqnarray}
      \begin{aligned}
        \sum \phi_i \partial_{\tau} u_i - \sum u_i \nabla_{\vec{x}}
        \phi_i \cdot \delta \vec{x}  &=  -\nabla p &\\
        \nabla_{\vec{x}} \cdot u_h   &=  0.&
      \end{aligned}
      \label{eq::continous_update}
    \end{eqnarray}

    \begin{remark}
       这里的~$p$ 跟外部~Navier-Stokes 方程的解~p 不一致，只是一个辅助量。
    \end{remark}

    (\ref{eq::continous_update}) 的弱形式：寻找~$\left(\vec{u}_h, p_h
    \right) \in X_E^h \times P_h$ 使得
    \begin{eqnarray}
      \begin{aligned}
        \left( \sum \phi_i \partial_{\tau}u_i - \sum u_i
          \nabla_{\vec{x}} \phi_i \cdot \delta \vec{x}, v_h \right)& =
        \left( p_h, \nabla v_h \right),& \quad \forall v_h \in X_E^h. \\
        \left( \nabla_{\vec{x}} \cdot u_h, q_h \right)& = 0, &\quad
        \forall q_h \in P_h
      \end{aligned}
      \label{eq::discreted_update}
    \end{eqnarray}
    (\ref{eq::continous_update}) 和~(\ref{eq::discreted_update}) 的初值为
    在~$t = t_n$ 时刻的网格上，$t = t_{n + 1}$ 时刻外部~Navier-Stokes 方
    程的解。

    时间方向的离散我们暂时先用线性~Euler 方法:
    \begin{eqnarray}
      \begin{aligned}
        \left ( \frac{\sum \phi_i u_{i, *}^{(n)} - \sum \phi_i
            u_i^{(n)}}{\Delta \tau}, v_h \right) - \left ( \sum
          u_i^{(n)} \nabla \phi_i \cdot \delta \vec{x}, v_h \right) &
        = \left( p_h^{(n)},  \nabla v_h \right).& \\
        \left( \nabla \cdot u_{h, *}^{(n)}, q_h \right) & = 0 &
      \end{aligned}
    \end{eqnarray}
    注意到在做数值解插值的过程中，物理网格还没有发生移动，这时候基函
    数~$\phi$ 仍然是~$t = t_n$ 时刻网格上的基函数。所以~$u_{h,*}^{(n)} = \sum
    u_{i, *}^{(n)} \phi_i^{(n)}, \quad u_h^{(n)} = \sum u_i^{(n)}
      \phi_i^{(n)}$ 简单整理一下：
    \begin{eqnarray}
      \begin{aligned}
        \left ( \frac{u_{h, *}^{(n)} - u_h^{(n)}}{\Delta \tau}, v_h
        \right) - \left (\nabla u_h^{(n)} \cdot \delta \vec{x}, v_h
        \right) & = \left( p_h^{(n)}, \nabla v_h \right).& \\
        \left( \nabla \cdot u_{h, *}^{(n)}, q_h \right) & = 0 &
      \end{aligned}
    \end{eqnarray}
    其中~$u_h^{(n)}$ 和~$p_h$ 是在~$t = t_n$ 时刻的网格上，$t = t_{n + 1}$
    时刻，Navier-Stokes 方程的数值解。而~$u_{h, *}^{(n)}$ 和~$p_{h,
      *}^{(n)}$ 是在新的网格上~$t = t_{n + 1}$ 时刻更新的解。但这组解不能
    当作外部~Navier-Stokes 方程的解。需要在新网格上重新求解~Navier-Stokes
    方程，得到的解才是我们想要的解。
   为了更好的说明我们的数值方法，我们将算法的流程图如~Algorithm(\ref{alg::solve}) 所示.
   \begin{algorithm}
     \caption{移动网格方法来求解~Navier Stokes 方程}
     \begin{algorithmic}[1]
       \State 在初始速度网格~$\triangle_v^{(0)}$ 和压力网格
       ~$\triangle_p^{(0)}$ 上，求解~$t = t_n$ 时刻~Stokes 方程~(\ref{eq::stokes}), 获
       得数值解~$\vec{u}_h^{(0)}, p_h^{(0)}$.
       \While {$t_n < T$}
             \State 在压力网格~$\triangle_p^{(n)}$ 上，用~$\vec{u}_h^{(n)},
                    p_h^{(n)}$ 来计算控制函数, 并通过求解
                    ~(\ref{eq::logical}), 获得~$\vec{\xi}^*$. \label{state::monitor}
             \State 判断~$\parallel \vec{\xi}^* -
                    \vec{\xi}^{(0)} \parallel_{L^2}$ 是否小于容忍量
                    ~$\epsilon$, 如果是迭代结束，否则，继续做
                    ~\ref{state::start} - \ref{state::end}.
             \State 用~$\vec{\xi}^* - \vec{\xi}^{(0)}$ 两者之差来计算
                    网格~$\triangle_p^{(n)}$ 的移动量~$\delta \vec{x}$.
                    \label{state::start}
             \State 利用~\ref{state::start} 中~$\delta \vec{x}$, 在速度网格
                    ~$\triangle_v^{(n)}$ 上求解更新数值解的方程
                    ~(\ref{eq::continous_update}), 得到新网格上的中间量
                    ~$\vec{u}_{h, *}^{(n)}, p_{h, *}^{(n)}$.
             \State 更新~$\triangle_p^{(n)}$, 通过几何遗传树结构，来
                    同步~$\triangle_v^{(n)}$, 得到新的~$\triangle_p^{(n
                    + 1)}$ 和~$\triangle_v^{(n + 1)}$
             \State 回到~\ref{state::monitor}. \label{state::end}
             \State 在~$\triangle_v^{(n + 1)}$ 和~$\triangle_p^{(n + 1)}$
                    上求解~Navier-Stokes 方程
                    ~(\ref{eq::linear_system}). 从而真正获得~$t = t_{n +
                      1}$ 时刻的数值解~$\vec{u}_h^{(n + 1)}, p_h^{(n +
                      1)}$.
             \State $n = n + 1$
        \EndWhile
     \end{algorithmic}
     \label{alg::solve}
   \end{algorithm}

    \section{数值算例}
       \subsection{Colliding Flow}
          这个例子为稳态~Stokes 方程的精确解，粘性系数~$\nu = 1.0$:
          \begin{equation}
            u_x = 20 x y^3; \quad u_y = 5 x^4 - 5 y^4; \quad p = 60 x^2 y - 20
            y^3 + \mbox{constant}.
            \label{eq::colliding}
          \end{equation}
          其中计算区域~$\Omega = [-1, -1] \times [1, 1]$, 边界条件全部
          是~Dirichlet 条件。这个例子是用来检验移动网格方法的收敛阶，此时
          解比较光滑。从文献~\cite{bercovier1979error} 可知，我们期望移
          动网格的收敛阶： 速度有二阶收敛，压力一阶收敛。我们先给出均
          匀网格时，误差的收敛阶，如
          ~Table(\ref{tab::colliding_uniform_error}) 和
          ~Table(\ref{tab::colliding_uniform_div_error}) 所示。

%          \begin{table}[!htbp]
%            \centering
%            \begin{tabular}{ccccccc} \hline
%              网格   & $||\vec{u} - \vec{u}_h ||_{L^2}$ & 误差阶 &$||\vec{u} -
%              \vec{u}_h ||_{H^1}$ & $||p - p_h||_{L^0}$ & 误差阶 &$||p -
%              p_h||_{H^1}$  \\ \hline
%              $10 \times 10$   &   $1.42 \times 10^{-1}$   &  &  $3.65 \times
%              10^0$     &   $1.26 \times 10^0$ & & $2.06 \times 10^1$    \\
%              $20 \times 20 $   &   $3.54 \times 10^{-2}$   & 2.01  &  $1.81 \times
%              10^0$     &   $3.90 \times 10^{-1}$ & 1.62 & $1.22 \times 10^1$   \\
%              $40 \times 40 $   &   $8.82 \times 10^{-3}$   & 2.01  & $9.03 \times
%              10^{-1}$  &   $1.14 \times 10^{-1}$ & 1.71 & $6.72 \times 10^0$   \\
%              $80 \times 80 $   &   $2.20 \times 10^{-3}$   & 2.00  & $4.51 \times
%              10^{-1}$  &   $3.39 \times 10^{-2}$ &  1.68 & $3.90 \times 10^0$  \\ \hline
%            \end{tabular}
%            \caption{\small 用均匀网格计算碰撞流的误差, $\nu = 1.0$.}
%            \label{tab::colliding_uniform_error}
%          \end{table}
%
%          \begin{table}[!htbp]
%            \centering
%            \begin{tabular}{ccccc} \hline
%              网格   & 涡量$L^2$误差 & 误差阶 & 散度$L^2$误差 & 误差阶\\ \hline
%              $10 \times 10$    &   $2.62 \times 10^{0}$   &  &   $2.54 \times
%              10^0$ &  \\
%              $20 \times 20 $   &   $1.31 \times 10^{0}$  & 1.00  &   $1.25 \times
%              10^0$ & 1.02 \\
%              $40 \times 40 $   &   $6.54 \times 10^{-1}$ & 1.00  &   $6.22 \times
%              10^{-1}$ &  1.00 \\
%              $80 \times 80 $   &   $3.27 \times 10^{-1}$ & 1.00  &   $3.10 \times
%              10^{-1}$ & 1.00 \\ \hline
%            \end{tabular}
%            \caption{\small 用均匀网格计算碰撞流的散度和涡量误差, $\nu = 1.0$.}
%            \label{tab::colliding_uniform_div_error}
%          \end{table}

          \begin{table}[!htbp]
            \centering
            \begin{tabular}{ccccccc} \hline
              网格   & $||\vec{u} - \vec{u}_h ||_{L^2}$ & 误差阶 &$||\vec{u} -
              \vec{u}_h ||_{H^1}$ & $||p - p_h||_{L^0}$ & 误差阶 &$||p -
              p_h||_{H^1}$  \\ \hline
              $10 \times 10$   &   $1.18 \times 10^{-1}$   &  &  $3.37 \times
              10^0$     &   $8.49 \times 10^{-1}$ & & $1.84 \times 10^1$    \\
              $20 \times 20 $   &   $2.94 \times 10^{-2}$   & 2.01  &  $1.67 \times
              10^0$     &   $2.330 \times 10^{-1}$ & 1.82 & $1.06 \times 10^1$   \\
              $40 \times 40 $   &   $7.37 \times 10^{-3}$   & 1.99  & $8.35 \times
              10^{-1}$  &   $6.54 \times 10^{-2}$ & 1.78 & $5.89 \times 10^0$   \\
              $80 \times 80 $   &   &  &  & &  &  \\ \hline
            \end{tabular}
            \caption{\small 用移动网格计算碰撞流的误差, $\nu = 1.0$.}
            \label{tab::colliding_moving_error}
          \end{table}

          \begin{table}[!htbp]
            \centering
            \begin{tabular}{ccccc} \hline
              网格   & 涡量~$L^2$ 误差 & 误差阶 & 散度~$L^2$ 误差 & 误差阶\\ \hline
              $10 \times 10$    &   $2.35 \times 10^{0}$   &  &   $2.41 \times
              10^0$ &  \\
              $20 \times 20 $   &   $1.16 \times 10^{0}$  & 1.01  &   $1.20 \times
              10^0$ & 1.00 \\
              $40 \times 40 $   &   $5.79 \times 10^{-1}$ & 1.00  &   $6.01 \times
              10^{-1}$ &  1.00 \\
              $80 \times 80 $   &  &   & &  \\ \hline
            \end{tabular}
            \caption{\small 用移动网格计算碰撞流的散度和涡量误差, $\nu = 1.0$.}
            \label{tab::colliding_moving_div_error}
          \end{table}

          我们采用上面一章中的移动网格方法来求解这个算例。选取
          ~(\ref{eq::monitor_gradient}) 为控制函数，其中~$\vec{u} = (u_x,
          u_y)^T$. $\alpha$ 和~$\beta$ 分别取为~$0.002$ 和~$2$. 从
          ~Table(\ref{tab::colliding_moving_error}) 中可以看出速度~$L^2$
          误差有二阶，压力收敛阶是一阶。从
          ~Table(\ref{tab::colliding_moving_div_error}) 可以看出速度散度
          和涡量均有一阶收敛。

          首先我们判断网格是不是往正确的方向移动。从
          ~Figure(\ref{fig::mesh_move_direction}) 中看出控制函数~$G_1$ 最大
          的地方分布在区域的四个顶角上，中间区域控制函数的值是比较小的。
          网格应该从控制函数小的地方移动到控制函数值大的地方。而网格的
          移动方向也确实是往四个顶角上移动。因此我们可以确定网格移动方
          向是对的。再者，判断选取~$G_1$ 为控制函数是否合适。从~Figure
          (\ref{fig::uniform_vs_moving_err}) 中看到：在均匀网格下，速度
          ~$L^2$ 误差最大的地方分布在四个顶角上，这与控制函数的分布是一
          致的。所以选取~$G_1$ 为控制函数是合理的。
          \begin{figure}[ht]
            \begin{center}
              \includegraphics[width = 0.43\textwidth, angle = -90]{picture/first/collidingFlow/mesh_move_direction.eps}
              \includegraphics[width = 0.43\textwidth, angle = -90]{picture/first/collidingFlow/pressure_contour.eps}
              \caption{\small 左：$m = \frac{1}{G_1}$ 的等高线和网格移
                动方向；右：压力等高线和速度的流速线 ~$\alpha = 0.002, \beta = 2.0$.}
              \label{fig::mesh_move_direction}
            \end{center}
          \end{figure}

          \begin{figure}[ht]
            \begin{center}
              \includegraphics[width = 0.43\textwidth, angle = -90]{picture/first/collidingFlow/uniform20_error.eps}
              \includegraphics[width = 0.43\textwidth, angle = -90]{picture/first/collidingFlow/moving20_error.eps}
              \caption{\small 速度~$L^2$ 误差分布，左：均匀网格；右：移动网格 ~$\alpha = 0.002, \beta = 2.0$.}
              \label{fig::uniform_vs_moving_err}
            \end{center}
          \end{figure}



          \begin{figure}[ht]
            \begin{center}
              \includegraphics[width = 0.43\textwidth, angle = -90]{picture/first/collidingFlow/uniform_mesh20.eps}
              \includegraphics[width = 0.43\textwidth, angle = -90]{picture/first/collidingFlow/moving_mesh20.eps}
              \caption{\small 网格对比，左：均匀网格~$20 \times 20$；右：移动网格 ~$\alpha = 0.002, \beta = 2.0$.}
              \label{fig::uniform_vs_moving_mesh}
            \end{center}
          \end{figure}

     \subsection{喷射流}

       这个算例模拟的是一个很细的流体喷射入一个静止的流场，这种现象可以参考~\cite{milton1982album}, 一本有趣的画册。
       我们的计算区域是~$\Omega = [0, 12] \times [-3, 3]$ 并且粘性系数是~$\nu = 0.0005$。自然条件设置在出流边界~$x = 12$ 上，
       同时入流边~$x = 0, y \in [-0.1, 0.1]$ 上设置~Poiseuille 流条件：
       \begin{equation}
         u_x = 1 - 100 y^2, u_y = 0.
       \end{equation}
       无滑移边界条件设置在~$\partial \Omega$ 的其余部分。

       在移动网格策略中，我们选取 ~(\ref{eq::monitor_vorticity}) 作为控制函数，参数~$\alpha = 2.0, \beta = 2.0$。
       据我们所知，当细流喷射到静止的流场中，会产生两个对称的涡。为了提高计算精度，在入射流周围需要更多的网格。
       从图~\ref{fig::jetting_flow_mesht12s} 中可以看出，网格集中在涡量值比较大的地方。随着时间的发展，流体的不
       稳定现象会出现，这跟~\cite{milton1982album} 中的物理现象是一致的。
       \begin{figure}[!htbp]
         \begin{center}
             \includegraphics[width = 0.53\textwidth, angle = -90]{picture/first/jet_flow_data/mesh_t12s.eps}
             \includegraphics[width = 0.53\textwidth, angle = -90]{picture/first/jet_flow_data/contour_t12s.eps}
        \end{center}
        \caption{\small Jetting flow: top: mesh, bottom: vorticity contour at t = 12s.}
        \label{fig::jetting_flow_mesht12s}
       \end{figure}

       \begin{figure}[!htbp]
         \begin{center}
             \includegraphics[width = 0.53\textwidth, angle = -90]{picture/first/jet_flow_data/mesh_t27s.eps}
             \includegraphics[width = 0.53\textwidth, angle = -90]{picture/first/jet_flow_data/contour_t27s.eps}
        \end{center}
        \caption{\small Jetting flow: top: mesh, bottom: vorticity contour at t = 27s.}
        \label{fig::jetting_flow_mesht27s}
       \end{figure}


   \subsection{Navier-Stokes 流经过一个凹形台阶}


      我们考虑~\cite{zheng2010posteriori} 中的算例，Navier-Stokes 流体以~$Re = 1000$ 经过一个凹形的台阶，计算区域是
      ~$\Omega = (0, 4) \times (0, 1)/(1.2, 1.6) \times (0, 0.4)$，在上下边界上，设置~$\vec{u} = (0, 0)^T$ 的边界条件。
      入流边上的边界条件为~$\vec{u} = (4 y (1 - y), 0)$，出流边是自然边界条件。

      我们选取涡量作为控制函数，控制函数的参数是 ~$\alpha = 0.4, \beta = 2.0$。众所周知，在这个问题中流体在凹进去的角上，
      会出现奇异性。从图~\ref{fig::step_initial_mesh} 中可以看出，初始的网格集中在凹进去的边上。$t = 0.5s, t = 1s \text{, and } t = 2s$
      时刻的网格以及涡量的等高线在图~\ref{fig::step_flow_05s}，\ref{fig::step_flow_1s} 和 ~\ref{fig::step_flow_2s} 中展示出
      来。我们发现，我们的网格跟涡的结构是一致的。

      $t = 2s$ 时，压力的等高线以及速度的流速线在图~\ref{fig::step_flow_contour_streamline_2s} 中给出。我们可以看出，在拐角处，压力的
      等高线是平滑的。

      \begin{figure}[!htbp]
        \begin{center}
        \includegraphics[width = 0.55\textwidth, angle = -90]{picture/first/step_flow_data/initial_mesh40_001.eps}
        \caption{\small Top: initial uniform mesh; bottom: initial moving mesh.}
        \label{fig::step_initial_mesh}
        \end{center}
      \end{figure}

      \begin{figure}[!htbp]
        \centering
        \includegraphics[width = 0.55\textwidth, angle = -90]{picture/first/step_flow_data/mesh_t_05.eps}
        \caption{\small Top: moving mesh; bottom: contour of vorticity
          at t = 0.5s}
        \label{fig::step_flow_05s}
      \end{figure}

      \begin{figure}[!htbp]
        \centering
        \includegraphics[width = 0.55\textwidth, angle = -90]{picture/first/step_flow_data/mesh_t_1s.eps}
        \caption{\small Top: moving mesh; bottom: contour of vorticity
          at t = 1s}
        \label{fig::step_flow_1s}
      \end{figure}

      \begin{figure}[!htbp]
        \centering
        \includegraphics[width = 0.55\textwidth, angle = -90]{picture/first/step_flow_data/mesh_t_1_5s.eps}
        \caption{\small Top: moving mesh; bottom: contour of vorticity
          at t = 1.5s}
        \label{fig::step_flow_1_5s}
      \end{figure}

      \begin{figure}[!htbp]
        \centering
        \includegraphics[width = 0.55\textwidth, angle = -90]{picture/first/step_flow_data/mesh_t_2s.eps}
        \caption{\small Top: moving mesh; bottom: contour of vorticity
          at t = 2s}
        \label{fig::step_flow_2s}
      \end{figure}

      \begin{figure}[!htbp]
        \centering
        \includegraphics[width = 0.55\textwidth, angle = -90]{picture/first/step_flow_data/contour_streamline_t_2s.eps}
        \caption{\small Top: pressure contour; bottom: velocity streamline
          at t = 2s}
        \label{fig::step_flow_contour_streamline_2s}
      \end{figure}

   \subsection{圆柱绕流}

      这个是经典算例，在一个长方形的管道中，流体流过一个圆柱。在~\cite{cao1999anr} 中，作者用移动有限元方法来求解这个
      模型。圆柱圆心是~$(0, 0)$，半径是~$r = 0.3$。粘性系数是 ~$\nu = 0.003$，计算区域是 ~$\Omega = [-1, 5] \times [-1, 1]$。
      Poiseuille 流 ~$u = 1 - y^2, v = 0$ 设置在入流边界 ~$x = -1$。边界条件 ~$u = v = 0$ 施加在管道的上下边界。出流边界 ~$x = 5$
      是自然边界条件。

      如果我们关注流体的细微结构，因此需要在小结构上有高分辨率。为了抓住涡的结构，在我们的移动策略中，(\ref{eq::monitor_vorticity})
      作为控制函数是一个很好的选择。具体的参数是 ~$\alpha$ 和 ~$\beta$ 分别为 ~$1.0$， $2.0$。

      在图~\ref{fig::cylinder_initial_mesh} 和 图 ~\ref{fig::cylinder_mesh_t24_5s} 中，展示了网格和涡的等高线的变化。从中可以看出，
      我们的网格可以抓住涡的结构，并且我们的网格质量比 ~\cite{cao1999anr} 中要好。
      当我们改变雷诺数为 ~$Re = 2000$ 时，从图~\ref{fig::cylinder_mesh_t23s} 中可以看出，网格和涡量的结构并不像 ~$Re = 2000/3$ 时那么明显。

      \begin{figure}[!htbp]
        \centering
        \includegraphics[width = 0.6\textwidth, angle = -90]{picture/first/obstacle_flow_data/initial_mesh.eps}
        \caption{\small Top: uniform mesh; bottom: initial
          moving mesh, viscosity $\nu = 0.003$.}
        \label{fig::cylinder_initial_mesh}
      \end{figure}

      \begin{figure}[!htbp]
       \begin{center}
         \includegraphics[width = 0.6\textwidth, angle = -90]{picture/first/obstacle_flow_data/mesh_t_24_5s.eps}
       \end{center}
       \caption{\small Top: moving mesh; bottom: vorticity contour at
         $t = 24.5s$, viscosity $\nu = 0.003$.}
       \label{fig::cylinder_mesh_t24_5s}
     \end{figure}

     \begin{figure}[!htbp]
       \centering
       \includegraphics[width = 0.6\textwidth, angle = -90]{picture/first/obstacle_flow_data/mesh_t_23s.eps}
       \caption{\small Top: moving mesh; bottom: vorticity contour at
         $t = 23s$, viscosity $\nu = 0.001$.}
       \label{fig::cylinder_mesh_t23s}
     \end{figure}



\begin{numcases}{}
|r(E(z),\lambda)| < |r(z,\lambda)|^3, &
if \ $r(z,\lambda) \in \overline{\MCD}_1\backslash\{0,1\}$,\ \ \  \label{ineq:abs_r(E(z))_1}\\
|r(E(z),\lambda)| \leq \sup_{m \geq
3}\left\{\left|\frac{S_m(u)}{u^3}\right|\right\}\cdot \frac{|u| +
|r(z,\lambda)|}{|u| - |r(z,\lambda)|} \cdot |r(z,\lambda)|^3,  & if
\  $r(z,\lambda) \in \mathcal {D}_0\backslash\{1\}$,
\label{ineq:abs_r(E(z))_2}
\end{numcases}



\begin{table}[h]
\begin{center}
\begin{tabular}{cc@{\hspace{0.7cm}}c@{\hspace{0.7cm}}c@{\hspace{0.7cm}}c@{\hspace{0.7cm}}c@{\hspace{0.7cm}}c}
\hline
& Algorithm & CPU time (s)& iter & $k_1$ & $\rho(X)$ & err($X$) \\
\hline
$A_1^{1/5}$ \\
& PSN & 3.91e-03 & 5 & 2 & 1.75e-15 & 2.05e-15 \\
& SN & 3.28e-03 & 6 & 2 & 4.67e-16 & 1.05e-15 \\
& SH & 3.13e-03 & 3 & 2 & 6.15e-16 & 9.63e-16 \\
& SE & 3.59e-03 & 3 & 3 & 8.77e-16 & 1.55e-15 \\
$A_2^{1/15}$ \\
& PSN & 6.09e-03 & 5 & 5 & 1.48e-15 & 2.67e-08 \\
& SN & 5.17e-03 & 6 & 4 & 5.74e-15 & 2.67e-08 \\
& SH & 5.00e-03 & 3 & 4 & 7.82e-15 & 2.67e-08 \\
& SE & 4.53e-03 & 5 & 5 & 2.25e-14 & 2.67e-08 \\

\hline
\end{tabular}
\end{center}
\caption{Results for computing $A_1^{1/5}$ and $A_2^{1/15}$ by using
the four Algorithms. } \label{tab:test3}
\end{table}



